<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sentiment Analyzer Test</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 800px;
        margin: 2em auto;
        padding: 1em;
        line-height: 1.6;
      }
      .test-section {
        margin: 2em 0;
        padding: 1.5em;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #f9f9f9;
      }
      button {
        padding: 0.6em 1.2em;
        margin: 0.5em 0.5em 0.5em 0;
        cursor: pointer;
        background: #0c1b50;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 1em;
      }
      button:hover {
        background: #1a2d70;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      input,
      select {
        padding: 0.5em;
        margin-right: 0.5em;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      #output {
        margin-top: 1em;
        padding: 1em;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 0.9em;
      }
      .error {
        color: #d32f2f;
      }
      .success {
        color: #388e3c;
      }
      h1 {
        color: #0c1b50;
      }
      h2 {
        color: #2a5298;
        border-bottom: 2px solid #2a5298;
        padding-bottom: 0.3em;
      }
    </style>
  </head>
  <body>
    <h1>üî¨ Sentiment Analyzer Test Page</h1>
    <p>
      This page tests the sentiment analysis functionality that fetches and analyzes GDELT tone
      data.
    </p>

    <div class="test-section">
      <h2>Test 1: Basic Analysis</h2>
      <p>Analyze sentiment for a specific query and timespan:</p>

      <div>
        <label>
          Query:
          <input type="text" id="testQuery" value="petroleum" style="width: 200px" />
        </label>
        <label>
          Timespan:
          <select id="testTimespan">
            <option value="1y">1 Year</option>
            <option value="2y">2 Years</option>
            <option value="5y">5 Years</option>
          </select>
        </label>
        <button onclick="runBasicTest()">Run Analysis</button>
      </div>

      <div id="output"></div>
    </div>

    <div class="test-section">
      <h2>Test 2: Quick Examples</h2>
      <p>Test with pre-configured queries:</p>

      <button onclick="testExample('oil spill', '1y')">Oil Spill (1Y)</button>
      <button onclick="testExample('climate change', '2y')">Climate Change (2Y)</button>
      <button onclick="testExample('renewable energy', '1y')">Renewable Energy (1Y)</button>
      <button onclick="testExample('fossil fuels', '5y')">Fossil Fuels (5Y)</button>
      <button onclick="testExample('"Amazon" AND Brazil', '1y')">Amazon Brazil (1Y)</button>

      <div id="exampleOutput"></div>
    </div>

    <div class="test-section">
      <h2>Test 3: Classification Boundary Tests</h2>
      <p>Test classification with synthetic data:</p>

      <button onclick="testClassification()">Run Classification Tests</button>

      <div id="classificationOutput"></div>
    </div>

    <script type="module">
      import { setupSentimentAnalyzer } from './js/sentimentAnalyzer.js';

      // Initialize the analyzer
      setupSentimentAnalyzer();

      // Make test functions global
      window.runBasicTest = async function () {
        const query = document.getElementById('testQuery').value;
        const timespan = document.getElementById('testTimespan').value;
        const output = document.getElementById('output');

        output.innerHTML = '<span class="info">‚è≥ Fetching and analyzing data...</span>';

        try {
          const analysis = await window.analyzeSentiment(query, timespan);

          if (analysis.success) {
            output.innerHTML = `<span class="success">‚úì Analysis Complete</span>\n\n${JSON.stringify(analysis, null, 2)}`;
          } else {
            output.innerHTML = `<span class="error">‚úó Analysis Failed</span>\n\n${analysis.error}`;
          }
        } catch (error) {
          output.innerHTML = `<span class="error">‚úó Error</span>\n\n${error.message}`;
        }
      };

      window.testExample = async function (query, timespan) {
        const output = document.getElementById('exampleOutput');
        output.innerHTML = `<span class="info">‚è≥ Analyzing "${query}" (${timespan})...</span>`;

        try {
          const analysis = await window.analyzeSentiment(query, timespan);

          if (analysis.success) {
            const { statistics, classification, trend } = analysis;
            output.innerHTML = `
<span class="success">‚úì Results for "${query}" (${timespan})</span>

Classification: ${classification.overall}
Average Tone: ${statistics.average}
Range: ${statistics.minimum} to ${statistics.maximum}

Overall Trend: ${trend.overall}
Recent Trend: ${trend.recent}
Volatility: ${classification.volatility} (œÉ = ${statistics.volatility})

Data Points: ${analysis.dataPoints}
`;
          } else {
            output.innerHTML = `<span class="error">‚úó Failed</span>\n${analysis.error}`;
          }
        } catch (error) {
          output.innerHTML = `<span class="error">‚úó Error</span>\n${error.message}`;
        }
      };

      window.testClassification = function () {
        const output = document.getElementById('classificationOutput');

        // Test tone classification
        const testCases = [
          { tone: 10, expected: 'Highly Positive' },
          { tone: 3, expected: 'Moderately Positive' },
          { tone: 0, expected: 'Neutral' },
          { tone: -3, expected: 'Moderately Negative' },
          { tone: -10, expected: 'Highly Negative' },
        ];

        let results = '<span class="success">Tone Classification Tests:</span>\n\n';

        function classifyTone(avgTone) {
          if (avgTone >= 5) return 'Highly Positive';
          if (avgTone >= 2) return 'Moderately Positive';
          if (avgTone >= -1) return 'Neutral';
          if (avgTone >= -5) return 'Moderately Negative';
          return 'Highly Negative';
        }

        testCases.forEach((test) => {
          const result = classifyTone(test.tone);
          const pass = result === test.expected;
          results += `Tone ${test.tone}: ${result} ${pass ? '‚úì' : '‚úó Expected: ' + test.expected}\n`;
        });

        // Test volatility classification
        results += '\n<span class="success">Volatility Classification Tests:</span>\n\n';

        const volTests = [
          { vol: 0.5, expected: 'very stable' },
          { vol: 1.5, expected: 'stable' },
          { vol: 2.5, expected: 'moderate' },
          { vol: 4, expected: 'volatile' },
          { vol: 7, expected: 'highly volatile' },
        ];

        function classifyVolatility(volatility) {
          if (volatility < 1) return 'very stable';
          if (volatility < 2) return 'stable';
          if (volatility < 3) return 'moderate';
          if (volatility < 5) return 'volatile';
          return 'highly volatile';
        }

        volTests.forEach((test) => {
          const result = classifyVolatility(test.vol);
          const pass = result === test.expected;
          results += `œÉ = ${test.vol}: ${result} ${pass ? '‚úì' : '‚úó Expected: ' + test.expected}\n`;
        });

        output.innerHTML = results;
      };
    </script>
  </body>
</html>
