<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://unpkg.com 'unsafe-inline'; style-src 'self' https://unpkg.com 'unsafe-inline'; img-src 'self' https://*.tile.openstreetmap.org https://server.arcgisonline.com data:; connect-src 'self' https://api.gdeltproject.org https://www.gdeltproject.org https://unpkg.com; frame-src https://api.gdeltproject.org; font-src 'self' data:;">
    <title>Extractive Industries News Mapper</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <div class="top-bar">
      <div style="display: flex; flex-direction: column; margin-bottom: 18px;">
        <span class="top-bar-title" style="margin-bottom: 0;">NewsMapper 1.0</span>
        <span style="font-size: 1.2rem; font-weight: 300; color: #ddd; font-style: italic;">Extractive industries</span>
      </div>
      <div class="header-right">
        <button class="info-btn" id="headerInfoBtn" title="About NewsMapper" aria-label="About NewsMapper" style="background: none; border: none; padding: 0; margin-left: 0.5em; cursor: pointer;">
          <svg width="22" height="22" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <circle cx="10" cy="10" r="9" stroke="#0c1b50" stroke-width="2" fill="#fff"/>
            <text x="10" y="15" text-anchor="middle" font-size="12" fill="#0c1b50" font-family="Arial, Helvetica, sans-serif" font-weight="bold">i</text>
          </svg>
        </button>
      </div>
    </div>
    <main>
        <section class="section-wrapper section-lightgray">
            <div class="floating-box">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <span id="sectionTitleQuery">Query</span>
                  <button class="info-btn" id="queryInfoBtn" title="About Query" aria-label="Query Info" style="background: none; border: none; padding: 0; margin-left: 0.5em; cursor: pointer;">
                    <svg width="22" height="22" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                      <circle cx="10" cy="10" r="9" stroke="#0c1b50" stroke-width="2" fill="#fff"/>
                      <text x="10" y="15" text-anchor="middle" font-size="12" fill="#0c1b50" font-family="Arial, Helvetica, sans-serif" font-weight="bold">i</text>
                    </svg>
                  </button>
                </div>
                <div id="queryWindow" style="display:flex;align-items:flex-end;gap:1em;flex-wrap:wrap;margin-top:0.7em;">
                  <div style="display:flex;flex-direction:row;gap:0.5em;align-items:flex-end;flex-wrap:wrap;">
                    <div class="custom-dropdown">
                      <label for="resourceInput">Resource</label>
                      <input id="resourceInput" name="resourceInput" type="text" placeholder="Resource" aria-label="Resource" autocomplete="off" />
                      <div id="resourceDropdown" class="dropdown-list" style="display:none;"></div>
                    </div>
                    <div class="custom-dropdown">
                      <label for="regionInput">Region</label>
                      <input id="regionInput" name="regionInput" type="text" placeholder="Region" aria-label="Region" autocomplete="off" />
                      <div id="regionDropdown" class="dropdown-list" style="display:none;"></div>
                    </div>
                    <div class="custom-dropdown">
                      <label for="countryInput">Country</label>
                      <input id="countryInput" name="countryInput" type="text" placeholder="Country" aria-label="Country" autocomplete="off" />
                      <div id="countryDropdownList" class="dropdown-list" style="display:none;"></div>
                    </div>
                    <div class="custom-dropdown">
                      <label for="customInput">Custom</label>
                      <input id="customInput" name="customInput" type="text" placeholder="Custom keywords or GDELT query" aria-label="Custom query" />
                    </div>
                    <button class="gdelt-open-btn query-time-btn" id="queryTime1d" type="button" aria-pressed="true" style="min-width:60px;">1d</button>
                    <button class="gdelt-open-btn query-time-btn" id="queryTime7d" type="button" aria-pressed="false" style="min-width:60px;">7d</button>
                    <button class="gdelt-open-btn query-time-btn" id="queryTime30d" type="button" aria-pressed="false" style="min-width:60px;">1m</button>
                    <button id="resetQueryBtn" type="button" class="gdelt-open-btn query-time-btn" style="min-width:60px;">Reset</button>
                    <button id="shareQueryBtn" type="button" class="gdelt-open-btn query-time-btn" style="min-width:60px;" title="Copy shareable link" onclick="window.copyShareableURL()">üîó Share</button>
                  </div>
                </div>
                <div class="floating-box" id="queryResultsWindow" style="padding:0.5em 1em !important;">
                  <div id="resultsHeaderRow" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0;cursor:pointer;" onclick="toggleResultsCollapse()">
                    <span id="resultsHeader" style="font-weight:600;font-size:1.08em;margin:0;padding:0;">Results</span>
                    <span id="resultsCollapseIcon" style="font-size:1.2em;transition:transform 0.2s;">‚ñ∂</span>
                  </div>
                  <div id="resultsContent" style="display:none;min-height:1em;padding:0;margin-top:0.4em;">
                    <div style="display:flex;align-items:center;margin-bottom:0.5em;gap:0.7em;"><span style="min-width:110px;font-weight:600;">GDELT Query:</span><code id="gdeltQueryResultBox" style="flex:1;min-width:80px;max-width:100%;white-space:pre-wrap;background:#f7f7fa;padding:0.3em 0.5em;border-radius:4px;overflow-x:auto;border:1px solid #bbb;box-shadow:0 1px 2px rgba(34,34,59,0.07);"></code></div>
                    <div style="display:flex;align-items:center;margin-bottom:0.5em;gap:0.7em;"><span style="min-width:110px;font-weight:600;">GeoJSON:</span><code id="geojsonUrlBox" style="flex:1;min-width:80px;max-width:100%;white-space:pre-wrap;background:#f7f7fa;padding:0.3em 0.5em;border-radius:4px;overflow-x:auto;border:1px solid #bbb;box-shadow:0 1px 2px rgba(34,34,59,0.07);"></code></div>
                    <div style="display:flex;align-items:center;margin-bottom:0.5em;gap:0.7em;"><span style="min-width:110px;font-weight:600;">Headlines:</span><code id="headlinesUrlBox" style="flex:1;min-width:80px;max-width:100%;white-space:pre-wrap;background:#f7f7fa;padding:0.3em 0.5em;border-radius:4px;overflow-x:auto;border:1px solid #bbb;box-shadow:0 1px 2px rgba(34,34,59,0.07);"></code></div>
                    <div style="display:flex;align-items:center;gap:0.7em;"><span style="min-width:110px;font-weight:600;">Timeline:</span><code id="timelineUrlBox" style="flex:1;min-width:80px;max-width:100%;white-space:pre-wrap;background:#f7f7fa;padding:0.3em 0.5em;border-radius:4px;overflow-x:auto;border:1px solid #bbb;box-shadow:0 1px 2px rgba(34,34,59,0.07);"></code></div>
                  </div>
                </div>
            </div>
            <div class="floating-box">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <span id="mapTitle">News Map</span>
                  <button class="info-btn" id="mapInfoBtn" title="About News Map" aria-label="News Map Info" style="background: none; border: none; padding: 0; margin-left: 0.5em; cursor: pointer;">
                    <svg width="22" height="22" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                      <circle cx="10" cy="10" r="9" stroke="#0c1b50" stroke-width="2" fill="#fff"/>
                      <text x="10" y="15" text-anchor="middle" font-size="12" fill="#0c1b50" font-family="Arial, Helvetica, sans-serif" font-weight="bold">i</text>
                    </svg>
                  </button>
                </div>
                <div style="position:relative;">
                    <div id="gdeltMapLoader" class="loader-overlay" style="display:none;">
                      <div class="loader-spinner"></div>
                    </div>
                    <div id="gdeltMapPlaceholder" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;background:#f0f0f0;color:#0c1b50;font-size:1.15em;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:2em;gap:1em;">
                      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#0c1b50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="10" r="3"/>
                        <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 6.9 8 11.7z"/>
                      </svg>
                      <div>Please enter a search term or select a resource, region, or country to view</div>
                    </div>
                    <div id="gdeltMapNoResults" style="display:none;position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;background:rgba(240,240,240,0.9);color:#0c1b50;font-size:1.15em;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:2em;gap:1em;">
                      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#0c1b50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                      </svg>
                      <div>No results found for this query.</div>
                    </div>
                    <div class="map-container"><div id="map"></div></div>
                </div>
                <div class="gdelt-result-row" style="display: flex; align-items: center; margin-bottom: 1em;">
                  <div id="mapTimeWarning" style="display:none; color:#d9534f; font-size:0.9em; font-weight:bold; margin-right:1em;">
                    Max. timeframe 7 days
                  </div>
                  <div style="margin-left:auto; display:flex; gap:0.5em;">
                    <button class="gdelt-open-btn" title="Download GeoJSON" onclick="window.downloadGeoJSON()">‚¨áÔ∏è</button>
                    <button class="gdelt-open-btn" title="Open" onclick="copyAndConfirmLink('gdeltMap')">üîó</button>
                    <button class="gdelt-embed-btn" title="Embed" onclick="window.copyEmbedCode('gdeltMap', 'Map', event)">&lt;&gt;</button>
                  </div>
                </div>
            </div>
            <div class="floating-box">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <span id="headlinesTitle">Headlines</span>
                  <button class="info-btn" id="headlinesInfoBtn" title="About Headlines" aria-label="Headlines Info" style="background: none; border: none; padding: 0; margin-left: 0.5em; cursor: pointer;">
                    <svg width="22" height="22" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                      <circle cx="10" cy="10" r="9" stroke="#0c1b50" stroke-width="2" fill="#fff"/>
                      <text x="10" y="15" text-anchor="middle" font-size="12" fill="#0c1b50" font-family="Arial, Helvetica, sans-serif" font-weight="bold">i</text>
                    </svg>
                  </button>
                </div>
                <div style="position:relative;">
                  <div id="gdeltHeadlinesLoader" class="loader-overlay" style="display:none;position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;align-items:center;justify-content:center;">
                    <div class="loader-spinner"></div>
                  </div>
                  <iframe id="gdeltHeadlines" width="100%" height="500" title="GDELT Headlines" allowfullscreen src="" tabindex="0"></iframe>
                  <div id="gdeltHeadlinesPlaceholder" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;background:#f0f0f0;color:#0c1b50;font-size:1.15em;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:2em;gap:1em;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#0c1b50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                      <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                    </svg>
                    <div>Please enter a search term or select a resource, region, or country to view</div>
                  </div>
                </div>
                <div class="gdelt-result-row" style="display: flex; align-items: center; margin-bottom: 1em;">
                    <span style="margin-left:1em; font-size:0.85em; color:#666; font-style:italic;" title="Google Translate bar appears at bottom of headlines page">üåê Scroll down for translation</span>
                    <div style="margin-left:auto; display:flex; gap:0.5em;">
                        <button class="gdelt-open-btn" title="Open" onclick="copyAndConfirmLink('gdeltHeadlines')">üîó</button>
                        <button class="gdelt-embed-btn" title="Embed" onclick="window.copyEmbedCode('gdeltHeadlines', 'Headlines', event)">&lt;&gt;</button>
                    </div>
                </div>
            </div>
            <div class="floating-box">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <span id="sentimentTitle">Sentiment</span>
                  <button class="info-btn" id="sentimentInfoBtn" title="About Sentiment Timeline" aria-label="Sentiment Info" style="background: none; border: none; padding: 0; margin-left: 0.5em; cursor: pointer;">
                    <svg width="22" height="22" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                      <circle cx="10" cy="10" r="9" stroke="#0c1b50" stroke-width="2" fill="#fff"/>
                      <text x="10" y="15" text-anchor="middle" font-size="12" fill="#0c1b50" font-family="Arial, Helvetica, sans-serif" font-weight="bold">i</text>
                    </svg>
                  </button>
                </div>
                <div style="position:relative;">
                  <div id="gdeltSentimentLoader" class="loader-overlay" style="display:none;">
                    <div class="loader-spinner"></div>
                  </div>
                  <div id="gdeltSentimentPlaceholder" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:11;background:#f0f0f0;color:#0c1b50;font-size:1.15em;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:2em;gap:1em;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#0c1b50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M3 3v18h18"/>
                      <path d="m19 9-5 5-4-4-3 3"/>
                    </svg>
                    <div>Please enter a search term or select a resource, region, or country to view</div>
                  </div>
                  <iframe id="gdeltSentiment" width="100%" height="400" title="GDELT Sentiment" allowfullscreen src="" tabindex="0"></iframe>
                </div>
                <div class="gdelt-result-row" style="margin-top: 1.5em; margin-bottom: 1em;">
                  <div style="margin-left:auto; display:flex; gap:0.5em;">
                    <button class="gdelt-open-btn" title="Open" onclick="copyAndConfirmLink('gdeltSentiment')">üîó</button>
                    <button class="gdelt-embed-btn" title="Embed" onclick="window.copyEmbedCode('gdeltSentiment', 'Sentiment', event)">&lt;&gt;</button>
                  </div>
                </div>
            </div>
        </section>
    </main>
    <div class="footer-bar">
        <div class="footer-note">
            Developed using GDELT by Metolius Research &copy; 2025
        </div>
    </div>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
    <script type="module" src="main.js"></script>
    <script>
      function toggleResultsCollapse() {
        const content = document.getElementById('resultsContent');
        const icon = document.getElementById('resultsCollapseIcon');
        if (content && icon) {
          if (content.style.display === 'none') {
            content.style.display = 'block';
            icon.textContent = '‚ñº';
          } else {
            content.style.display = 'none';
            icon.textContent = '‚ñ∂';
          }
        }
      }
    </script>
    <div id="headerInfoOverlay" class="header-info-overlay" style="display:none;"></div>
    <div id="headerInfoPopup" class="header-info-popup" style="display:none;">
      <button class="header-info-close-x" id="headerInfoClose" title="Close">&times;</button>
      <div class="header-info-header">About the Extractive Industries News Mapper</div>
      <div class="header-info-body">
        The Extractive Industries News Mapper is an interactive tool for exploring global news events related to extractive
         industries, land use conflict, and environmental issues.<br><br> This effort is not affiliated with GDELT <a href="https://www.gdeltproject.org/" target="_blank" rel="noopener">(gdeltproject.org)</a>,
         but does provide an interface to some of its data services using the GDELT database.<br><br>
         The Extractive Industries News Mapper was inspired in part by <a href="https://github.com/gdelt/gdelt.github.io"target="_blank" rel="noopener">gdelt.github.io</a><br><br>
        <b>How to use:</b>
        <ul>
          <li>Use the <b>Query</b> box to select a resource, region, or country, or enter your own custom search terms.</li>
          <li>The <b>News Map</b> visualizes the locations of recent news events matching your query.</li>
          <li><b>Headlines</b> lists the most recent news articles found for your search.</li>
          <li>The <b>Sentiment</b> timeline shows how positive or negative the news coverage has been over time.</li>
          <li>Click the info (<b>i</b>) buttons in each section for more details and tips.</li>
          <li>All data is sourced from <a href="https://www.gdeltproject.org/" target="_blank" rel="noopener">GDELT</a>. For advanced users, you can view or modify the underlying GDELT query.</li>
        </ul>
      </div>
    </div>
    <div id="queryInfoOverlay" class="query-info-overlay" style="display:none;"></div>
    <div id="queryInfoPopup" class="query-info-popup" style="display:none;">
      <button class="query-info-close-x" id="queryInfoClose" title="Close">&times;</button>
      <div class="query-info-header">How to use the Query box</div>
      <div class="query-info-body">
        <ul>
          <li><b>Resource</b>: Choose a topic such as Fossil Fuels, Mining, Agroindustry, or Logging to filter news by industry or issue.</li>
          <li><b>Region</b>: Optionally, select a region (e.g. Africa, Latin America) to focus your search geographically.</li>
          <li><b>Country</b>: You can also select a specific country for more targeted results.</li>
          <li><b>Custom</b>: Enter your own keywords or GDELT query terms for advanced searches (e.g. "oil spill" AND river).</li>
          <li>The <b>Result</b> box displays the actual GDELT query being used. You can copy or modify this for use on the GDELT website.</li>
          <li>Use the <b>reset</b> button to clear the country field and start a new search.</li>
        </ul>
      </div>
    </div>
    <div id="mapInfoOverlay" class="query-info-overlay" style="display:none;"></div>
    <div id="mapInfoPopup" class="query-info-popup" style="display:none;">
      <button class="query-info-close-x" id="mapInfoClose" title="Close">&times;</button>
      <div class="query-info-header">About the News Map</div>
      <div class="query-info-body">
        <ul>
          <li>The map displays the locations of news events matching your search criteria.</li>
          <li>Click on a map point to see a summary and a link to the original article.</li>
          <li>Use the time buttons (1d, 7d) to change the date range of news shown on the map.</li>
          <li>Map data is based on automated location extraction and may not be 100% accurate.</li>
        </ul>
      </div>
    </div>
    <div id="headlinesInfoOverlay" class="query-info-overlay" style="display:none;"></div>
    <div id="headlinesInfoPopup" class="query-info-popup" style="display:none;">
      <button class="query-info-close-x" id="headlinesInfoClose" title="Close">&times;</button>
      <div class="query-info-header">About Headlines</div>
      <div class="query-info-body">
        <ul>
          <li>This section lists the most recent news headlines found for your query.</li>
          <li>Click a headline to open the full article in a new tab.</li>
          <li>Use the time buttons (1d, 7d, 1M, 1Y) to change the date range of articles displayed.</li>
          <li>Only the most recent 100 articles are shown for each time range.</li>
        </ul>
      </div>
    </div>
    <div id="sentimentInfoOverlay" class="query-info-overlay" style="display:none;"></div>
    <div id="sentimentInfoPopup" class="query-info-popup" style="display:none;">
      <button class="query-info-close-x" id="sentimentInfoClose" title="Close">&times;</button>
      <div class="query-info-header">About Sentiment Timeline</div>
      <div class="query-info-body">
        <ul>
          <li>This chart shows the average tone (sentiment) of news coverage over time for your search.</li>
          <li>Positive values indicate more positive news, negative values indicate more negative news.</li>
          <li>Use the time buttons (1Y, 2Y, 5Y) to change the date range of the sentiment analysis.</li>
          <li>Sentiment is calculated automatically and may not reflect the full nuance of each article.</li>
        </ul>
      </div>
    </div>
    <script>
    </script>
</body>
</html>